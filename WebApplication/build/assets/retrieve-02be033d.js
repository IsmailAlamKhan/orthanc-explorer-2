import{k as n,m,_ as l,o,c as r,a as c,x as a,r as p,b as y,a8 as f,a9 as g,aa as v,ab as _}from"./index-bff01d9e.js";const w={props:[],async created(){const e=new URLSearchParams(window.location.search);e.has("StudyInstanceUID")?this.studyInstanceUid=e.get("StudyInstanceUID"):e.has("study")?this.studyInstanceUid=e.get("study"):console.error("No study defined.  Use StudyInstanceUID=1.2.3.... in your url");const t=e.get("modality");e.has("viewer")&&(this.viewer=e.get("viewer"));const s=await n.findStudy(this.studyInstanceUid);if(s==null){if(this.state="finding-remotely",(await n.remoteDicomFindStudies(t,{StudyInstanceUID:this.studyInstanceUid})).length==0)this.state="not-found";else if(this.remoteMode=="dicom"){const i={StudyInstanceUID:this.studyInstanceUid},d=await n.remoteDicomRetrieveStudy(t,i,this.system.DicomAet,"Study");this.state="retrieving",this.startMonitoringJob(d)}}else this.studyOrthancId=s.ID,this.openViewer()},setup(){return{}},data(){return{state:"finding-locally",remoteMode:"dicom",viewer:"stone-viewer",retrievedInstancesCount:0,studyInstanceUid:null,studyOrthancId:null,jobProgressComplete:0,jobProgressFailed:0,jobProgressRemaining:100,jobRefreshTimeout:200,jobIsComplete:!1,jobIsRunning:!1,jobIsSuccess:!1}},mounted(){},methods:{startMonitoringJob(e){this.jobRefreshTimeout=200,setTimeout(this.monitorJob,this.jobRefreshTimeout,[e])},openViewer(){this.viewer=="stone-viewer"?window.location.href=n.getStoneViewerUrl("study",this.studyInstanceUid):this.viewer=="osimis-viewer"?window.location.href=n.getOsimisViewerUrl("study",this.studyOrthancId):this.viewer=="ohif-viewer"?window.location.href=n.getOh("study",this.studyOrthancId):console.error("unsupported viewer: ",this.viewer)},async monitorJob(e){const t=await n.getJobStatus(e);if(this.jobIsComplete=t.State=="Success"||t.State=="Failure",this.jobIsRunning=t.State=="Running",this.jobIsSuccess=t.State=="Success",this.jobIsComplete)this.jobProgressRemaining=0,this.jobIsSuccess?(this.jobProgressComplete=100,this.jobProgressFailed=0):(this.jobProgressComplete=0,this.jobProgressFailed=100);else{if(this.studyOrthancId==null){const s=await n.findStudy(this.studyInstanceUid);s!=null&&(this.studyOrthancId=s.ID)}else{const s=await n.getStudyInstances(this.studyOrthancId);this.retrievedInstancesCount=s.length}this.jobProgressFailed=0,this.jobProgressComplete=t.Progress,this.jobProgressRemaining=100-this.jobProgressComplete}this.jobIsComplete?this.openViewer():(this.jobRefreshTimeout=Math.min(this.jobRefreshTimeout+200,2e3),setTimeout(this.monitorJob,this.jobRefreshTimeout,[e]))}},computed:{...m({system:e=>e.configuration.system})},components:{}},I={class:"d-flex flex-column min-vh-100 justify-content-center align-items-center h4 text-center"},b=["innerHTML"],j=["innerHTML"],S=["innerHTML"],R=["innerHTML"],T=["innerHTML"],U=c("div",{class:"spinner-border",role:"status"},[c("span",{class:"visually-hidden"},"Loading...")],-1);function C(e,t,s,u,i,d){return o(),r("div",I,[c("span",null,[i.state=="finding-locally"?(o(),r("p",{key:0,innerHTML:e.$t("retrieve_and_view.finding_locally")},null,8,b)):a("",!0),i.state=="finding-remotely"?(o(),r("p",{key:1,innerHTML:e.$t("retrieve_and_view.finding_remotely")},null,8,j)):a("",!0),i.state=="not-found"?(o(),r("p",{key:2,innerHTML:e.$t("retrieve_and_view.not_found")},null,8,S)):a("",!0),i.state=="retrieving"?(o(),r("p",{key:3,innerHTML:e.$t("retrieve_and_view.retrieving")},null,8,R)):a("",!0),i.state=="retrieving"?(o(),r("p",{key:4,innerHTML:e.$t("retrieve_and_view.retrieved_html",{count:i.retrievedInstancesCount})},null,8,T)):a("",!0),U])])}const M=l(w,[["render",C]]);const V={async created(){console.log("Creating RetrieveAndView App..."),await this.$store.dispatch("configuration/load"),console.log("RetrieveAndView App created")},components:{RetrieveAndView:M}},P={class:"full-page"};function A(e,t,s,u,i,d){const h=p("RetrieveAndView");return o(),r("div",P,[y(h)])}const L=l(V,[["render",A]]);f.get("../api/pre-login-configuration").then(e=>{const t=g(L);t.use(v),t.use(_),t.mount("#app-retrieve-and-view")});
